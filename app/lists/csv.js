// Generated by CoffeeScript 1.3.3

(function(head, req) {
  var columnName, columnNames, columns, csvRowData, key, row, rowData, value, _i, _j, _len, _len1, _ref;
  start({
    "headers": {
      "content-type": "text/csv"
    }
  });
  columns = {};
  csvRowData = [];
  while (row = getRow()) {
    csvRowData.push(row.value);
    _ref = Object.keys(row.value);
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      key = _ref[_i];
      columns[key] = true;
    }
  }
  columnNames = (function() {
    var _results;
    _results = [];
    for (key in columns) {
      value = columns[key];
      _results.push(key);
    }
    return _results;
  })();
  send(columnNames.join(",") + "\n");
  for (_j = 0, _len1 = csvRowData.length; _j < _len1; _j++) {
    row = csvRowData[_j];
    rowData = (function() {
      var _k, _len2, _results;
      _results = [];
      for (_k = 0, _len2 = columnNames.length; _k < _len2; _k++) {
        columnName = columnNames[_k];
        _results.push(row[columnName]);
      }
      return _results;
    })();
    send(rowData.join(",") + "\n");
  }
});
